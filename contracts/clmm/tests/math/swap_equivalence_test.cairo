// generated by scripts/gen_swap_equivalence_test.py
use crate::math::swap::swap_result;
use crate::types::i129::i129;

#[derive(Copy, Drop)]
struct SwapCase {
    sqrt_ratio: u256,
    sqrt_ratio_limit: u256,
    liquidity: u128,
    amount_remaining: u128,
    is_token1: bool,
    fee: u128,
    expected_sqrt_ratio_next: u256,
    expected_amount_in: u128,
    expected_amount_out: u128,
    expected_fee_amount: u128,
    expected_is_limited: bool,
}

#[test]
fn test_swap_circom_equivalence() {
    let cases = array![
        SwapCase {
        sqrt_ratio: u256 { low: 76611969721940870279332076356, high: 0 },
        sqrt_ratio_limit: u256 { low: 78893101296076035009652763114, high: 0 },
        liquidity: 11527030704028348957,
        amount_remaining: 13571759309330593114,
        is_token1: true,
        fee: 861673498,
        expected_sqrt_ratio_next: u256 { low: 78893101296076035009652763114, high: 0 },
        expected_amount_in: 77273102,
        expected_amount_out: 1480374425890549941437859394,
        expected_fee_amount: 1,
        expected_is_limited: true,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 3004983557467580047126597284, high: 0 },
        sqrt_ratio_limit: u256 { low: 2516309632471080730708109445, high: 0 },
        liquidity: 16511889326986620525,
        amount_remaining: 9195759504668971298,
        is_token1: false,
        fee: 973265653,
        expected_sqrt_ratio_next: u256 { low: 3004983557452801368994219515, high: 0 },
        expected_amount_in: 9195759504668971298,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 62304869448323054196046352828, high: 0 },
        sqrt_ratio_limit: u256 { low: 25373550701133394355066419994, high: 0 },
        liquidity: 14379282636330708671,
        amount_remaining: 14485295797273079922,
        is_token1: false,
        fee: 348429843,
        expected_sqrt_ratio_next: u256 { low: 62304869436831078904085499981, high: 0 },
        expected_amount_in: 14485295797273079922,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 36001519091381991310104325258, high: 0 },
        sqrt_ratio_limit: u256 { low: 51895201951349266118397261126, high: 0 },
        liquidity: 16028012553766001442,
        amount_remaining: 6317704627362305992,
        is_token1: true,
        fee: 3235712017,
        expected_sqrt_ratio_next: u256 { low: 51895201951349266118397261126, high: 0 },
        expected_amount_in: 748625770,
        expected_amount_out: 46397612041262451637383696944,
        expected_fee_amount: 1,
        expected_is_limited: true,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 31925792466958150808124678974, high: 0 },
        sqrt_ratio_limit: u256 { low: 4971476982555161092005396216, high: 0 },
        liquidity: 13222137503076245308,
        amount_remaining: 9784316547435424353,
        is_token1: false,
        fee: 3089219090,
        expected_sqrt_ratio_next: u256 { low: 31925792464741625201592553424, high: 0 },
        expected_amount_in: 9784316547435424353,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 40606943908629910489136544366, high: 0 },
        sqrt_ratio_limit: u256 { low: 60423440076439476156207909637, high: 0 },
        liquidity: 12423846064195983743,
        amount_remaining: 6302328750852090283,
        is_token1: true,
        fee: 3915363179,
        expected_sqrt_ratio_next: u256 { low: 60423440076439476156207909637, high: 0 },
        expected_amount_in: 723508246,
        expected_amount_out: 34144174829786906692334956439,
        expected_fee_amount: 1,
        expected_is_limited: true,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 52361165914302144583004660746, high: 0 },
        sqrt_ratio_limit: u256 { low: 64594282195690480077238867572, high: 0 },
        liquidity: 11487034882309655738,
        amount_remaining: 18068153716918083218,
        is_token1: true,
        fee: 2228420810,
        expected_sqrt_ratio_next: u256 { low: 64594282195690480077238867572, high: 0 },
        expected_amount_in: 412957730,
        expected_amount_out: 14137776246859016560003561122,
        expected_fee_amount: 1,
        expected_is_limited: true,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 32081700411061166728240792029, high: 0 },
        sqrt_ratio_limit: u256 { low: 51472407326535706237073363866, high: 0 },
        liquidity: 14419202759114456139,
        amount_remaining: 17764159999491371538,
        is_token1: true,
        fee: 295308188,
        expected_sqrt_ratio_next: u256 { low: 51472407326535706237073363866, high: 0 },
        expected_amount_in: 821666246,
        expected_amount_out: 57615916775148670163520820675,
        expected_fee_amount: 1,
        expected_is_limited: true,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 30657729898156365539270039538, high: 0 },
        sqrt_ratio_limit: u256 { low: 4348396287576386763277719692, high: 0 },
        liquidity: 11937865890003815231,
        amount_remaining: 9188377226252916738,
        is_token1: false,
        fee: 296117732,
        expected_sqrt_ratio_next: u256 { low: 30657729896030417413468131413, high: 0 },
        expected_amount_in: 9188377226252916738,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 33753134241460796386292038041, high: 0 },
        sqrt_ratio_limit: u256 { low: 5563218695479090080003518935, high: 0 },
        liquidity: 10217412952559671524,
        amount_remaining: 931505757777266297,
        is_token1: false,
        fee: 334835765,
        expected_sqrt_ratio_next: u256 { low: 33753134241155562064692128791, high: 0 },
        expected_amount_in: 931505757777266297,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 13330093378507276387512194850, high: 0 },
        sqrt_ratio_limit: u256 { low: 7292627567304387222586593840, high: 0 },
        liquidity: 5432717721915966670,
        amount_remaining: 16453071435804946551,
        is_token1: false,
        fee: 2641919636,
        expected_sqrt_ratio_next: u256 { low: 13330093376925821595567878183, high: 0 },
        expected_amount_in: 16453071435804946551,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 34962540953809400557741200470, high: 0 },
        sqrt_ratio_limit: u256 { low: 22468895212981132943766549718, high: 0 },
        liquidity: 3211748873433341558,
        amount_remaining: 4969097832355682159,
        is_token1: false,
        fee: 2569068028,
        expected_sqrt_ratio_next: u256 { low: 34962540948251605887494549004, high: 0 },
        expected_amount_in: 4969097832355682159,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 57939590668818092314445141059, high: 0 },
        sqrt_ratio_limit: u256 { low: 28687227829815231831790863796, high: 0 },
        liquidity: 4898888324733067709,
        amount_remaining: 11311905679053633926,
        is_token1: false,
        fee: 4016251860,
        expected_sqrt_ratio_next: u256 { low: 57939590646038306514645310676, high: 0 },
        expected_amount_in: 11311905679053633926,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 52583736047483167273924024309, high: 0 },
        sqrt_ratio_limit: u256 { low: 23913857487782428424286149626, high: 0 },
        liquidity: 3182100376862618313,
        amount_remaining: 10445723808919558938,
        is_token1: false,
        fee: 1384728179,
        expected_sqrt_ratio_next: u256 { low: 52583736020809170336698622496, high: 0 },
        expected_amount_in: 10445723808919558938,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 62832278189835875030393432930, high: 0 },
        sqrt_ratio_limit: u256 { low: 11120130466466008391306549859, high: 0 },
        liquidity: 14327107574499541044,
        amount_remaining: 7599424867944018929,
        is_token1: false,
        fee: 1389006379,
        expected_sqrt_ratio_next: u256 { low: 62832278183682004253416816919, high: 0 },
        expected_amount_in: 7599424867944018929,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 17964328575192634891527621068, high: 0 },
        sqrt_ratio_limit: u256 { low: 22662365660094572940746042874, high: 0 },
        liquidity: 14067311367114958395,
        amount_remaining: 8544193491305592348,
        is_token1: true,
        fee: 790091393,
        expected_sqrt_ratio_next: u256 { low: 22662365660094572940746042874, high: 0 },
        expected_amount_in: 194217384,
        expected_amount_out: 55239629031186170355493664543,
        expected_fee_amount: 1,
        expected_is_limited: true,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 30827089449165360127253109061, high: 0 },
        sqrt_ratio_limit: u256 { low: 44969406992010153815017495715, high: 0 },
        liquidity: 8227071141968656086,
        amount_remaining: 14972507231230673850,
        is_token1: true,
        fee: 2636077822,
        expected_sqrt_ratio_next: u256 { low: 44969406992010153815017495715, high: 0 },
        expected_amount_in: 341921487,
        expected_amount_out: 28559828749499826782711542936,
        expected_fee_amount: 1,
        expected_is_limited: true,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 46530636075195802286526273463, high: 0 },
        sqrt_ratio_limit: u256 { low: 73354164015499869442553733921, high: 0 },
        liquidity: 3485251643407517698,
        amount_remaining: 3621067863261480682,
        is_token1: true,
        fee: 641052523,
        expected_sqrt_ratio_next: u256 { low: 73354164015499869442553733921, high: 0 },
        expected_amount_in: 274732853,
        expected_amount_out: 9320210512181157484166161676,
        expected_fee_amount: 1,
        expected_is_limited: true,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 50356714156602203006861872224, high: 0 },
        sqrt_ratio_limit: u256 { low: 8732149647519816372039387254, high: 0 },
        liquidity: 13355723492350134875,
        amount_remaining: 18223596612627028877,
        is_token1: false,
        fee: 1526549706,
        expected_sqrt_ratio_next: u256 { low: 50356714146434051762229489020, high: 0 },
        expected_amount_in: 18223596612627028877,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 50761148643988274404552300406, high: 0 },
        sqrt_ratio_limit: u256 { low: 26128019476252634727939347517, high: 0 },
        liquidity: 12550043627489868009,
        amount_remaining: 16973779697206430822,
        is_token1: false,
        fee: 694632782,
        expected_sqrt_ratio_next: u256 { low: 50761148633746934924134474480, high: 0 },
        expected_amount_in: 16973779697206430822,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 74147611095178241487691506962, high: 0 },
        sqrt_ratio_limit: u256 { low: 78787884618967842343043740624, high: 0 },
        liquidity: 7705559638653313777,
        amount_remaining: 6375229539183917792,
        is_token1: true,
        fee: 2516017052,
        expected_sqrt_ratio_next: u256 { low: 78787884618967842343043740624, high: 0 },
        expected_amount_in: 105077161,
        expected_amount_out: 2082718662131313891224812103,
        expected_fee_amount: 1,
        expected_is_limited: true,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 65414800806074772265944129780, high: 0 },
        sqrt_ratio_limit: u256 { low: 74486999571510198795945233558, high: 0 },
        liquidity: 16533008441415269421,
        amount_remaining: 6078448356387401600,
        is_token1: true,
        fee: 1663427677,
        expected_sqrt_ratio_next: u256 { low: 74486999571510198795945233558, high: 0 },
        expected_amount_in: 440783167,
        expected_amount_out: 10474839692908636897780648123,
        expected_fee_amount: 1,
        expected_is_limited: true,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 29066210877811273898084196183, high: 0 },
        sqrt_ratio_limit: u256 { low: 14047678582369114955830211161, high: 0 },
        liquidity: 11159356952568157285,
        amount_remaining: 14050081299153359358,
        is_token1: false,
        fee: 4152390485,
        expected_sqrt_ratio_next: u256 { low: 29066210874685359629773991407, high: 0 },
        expected_amount_in: 14050081299153359358,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 13314830880689351342650239464, high: 0 },
        sqrt_ratio_limit: u256 { low: 71046115213641989094219438339, high: 0 },
        liquidity: 12751210597275405589,
        amount_remaining: 7495806400297701032,
        is_token1: true,
        fee: 1184339405,
        expected_sqrt_ratio_next: u256 { low: 71046115213641989094219438339, high: 0 },
        expected_amount_in: 2163332093,
        expected_amount_out: 264804945918216600813736700393,
        expected_fee_amount: 1,
        expected_is_limited: true,
    },
        SwapCase {
        sqrt_ratio: u256 { low: 34044515922738668089602089628, high: 0 },
        sqrt_ratio_limit: u256 { low: 15672184105763666382403038776, high: 0 },
        liquidity: 10101778225383453777,
        amount_remaining: 17804366015201582855,
        is_token1: false,
        fee: 4060402289,
        expected_sqrt_ratio_next: u256 { low: 34044515916735457677498162075, high: 0 },
        expected_amount_in: 17804366015201582855,
        expected_amount_out: 0,
        expected_fee_amount: 1,
        expected_is_limited: false,
    }
    ];
    let mut i = 0;
    while (i < cases.len()) {
        let case = *cases.at(i);
        let result = swap_result(
            sqrt_ratio: case.sqrt_ratio,
            liquidity: case.liquidity,
            sqrt_ratio_limit: case.sqrt_ratio_limit,
            amount: i129 { mag: case.amount_remaining, sign: false },
            is_token1: case.is_token1,
            fee: case.fee,
        );
        assert(result.sqrt_ratio_next == case.expected_sqrt_ratio_next, 'sqrt_ratio_next');
        assert(
            result.consumed_amount == i129 { mag: case.expected_amount_in, sign: false },
            'amount_in',
        );
        assert(result.calculated_amount == case.expected_amount_out, 'amount_out');
        assert(result.fee_amount == case.expected_fee_amount, 'fee_amount');
        assert(
            (result.sqrt_ratio_next == case.sqrt_ratio_limit) == case.expected_is_limited,
            'is_limited',
        );
        i += 1;
    }
}
